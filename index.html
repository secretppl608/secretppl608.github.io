  <!DOCTYPE html>
 <html lang="zh-CN">
 <head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>客服订单信息生成工具</title>
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
     <style>
  .query-link {
    font-weight: 700;
    color: #87ceeb; /* skyblue的十六进制值 */
    font-size: 2rem;
    text-decoration: none;
    transition: color 0.3s;
    display: inline-block;
  }
  .query-link:hover {
    color: #63b8ff; /* 悬停加深 */
    text-decoration: underline;
  }
       @media (max-width: 768px) {
  .query-link { font-size: 1.5rem; }
       }

         /* 基础样式重置 */
   .form-control {
            width: 45%;
            padding: 12px 15px;
            font-size: 1rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: white;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        
        .form-control:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        select[multiple],input[type="number"] {
            width: 45%;
            padding: 12px 15px;
            font-size: 1rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: white;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        
       select[multiple]:focus ,input[type="number"]:focus{
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

         * {
             box-sizing: border-box;
             margin: 0;
             padding: 0;
             font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
         }
         
         body {
             background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
             color: #333;
             line-height: 1.6;
             padding: 20px;
             min-height: 100vh;
         }
         
         .container {
             max-width: 800px;
             margin: 0 auto;
             background: white;
             border-radius: 16px;
             box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
             overflow: hidden;
             padding: 25px;
         }
         
         header {
             text-align: center;
             margin-bottom: 25px;
             padding-bottom: 15px;
             border-bottom: 2px solid #eaeaea;
         }
         
         h1 {
             color: #2c3e50;
             font-size: 1.8rem;
             margin-bottom: 8px;
         }
         
         .subtitle {
             color: #7f8c8d;
             font-size: 1rem;
             font-weight: 500;
         }
         
         /* 输入区域样式 */
         .input-group {
             margin-bottom: 20px;
         }
         
         .input-group label {
             display: block;
             margin-bottom: 8px;
             font-weight: 600;
             color: #2c3e50;
             font-size: 0.9rem;
         }
         
         textarea {
             width: 100%;
             padding: 14px;
             border: 2px solid #e0e6ed;
             border-radius: 10px;
             font-size: 1rem;
             resize: vertical;
             min-height: 100px;
             transition: all 0.3s ease;
             background: #f9fbfd;
         }
         
         textarea:focus {
             outline: none;
             border-color: #3498db;
             box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
             background: white;
         }
         
         /* 订单信息样式 */
         .order-info-container {
             background: linear-gradient(to right, #f8f9fa, #ffffff);
             border-radius: 12px;
             padding: 25px;
             margin: 30px 0;
             border: 1px solid #e0e6ed;
             box-shadow: 0 4px 12px rgba(0, 0, 0, 0.03);
             position: relative;
             overflow: hidden;
         }
         
         .order-info-container::before {
             content: "";
             position: absolute;
             top: 0;
             left: 0;
             width: 5px;
             height: 100%;
             background: linear-gradient(to bottom, #3498db, #2ecc71);
         }
         
         .order-info-title {
             font-size: 1.3rem;
             color: #2c3e50;
             margin-bottom: 18px;
             font-weight: 600;
         }
         
         .order-info-item {
             margin-bottom: 14px;
             padding-left: 15px;
             position: relative;
             font-size: 1.05rem;
         }
         
         .order-info-item::before {
             content: "•";
             position: absolute;
             left: 0;
             color: #3498db;
             font-weight: bold;
         }
         
         .highlight {
             color: #e74c3c;
             font-weight: 600;
             background: rgba(231, 76, 60, 0.08);
             padding: 2px 6px;
             border-radius: 4px;
         }
         
         /* 复制按钮样式 */
         .copy-btn-container {
             text-align: center;
             margin-top: 25px;
         }
         
         #copyOrderBtn {
             background: linear-gradient(to right, #3498db, #2ecc71);
             color: white;
             border: none;
             padding: 14px 35px;
             font-size: 1.1rem;
             font-weight: 600;
             border-radius: 50px;
             cursor: pointer;
             transition: all 0.3s ease;
             box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
             display: inline-flex;
             align-items: center;
             gap: 8px;
         }
         
         #copyOrderBtn:hover {
             transform: translateY(-3px);
             box-shadow: 0 7px 20px rgba(52, 152, 219, 0.4);
         }
         
         #copyOrderBtn:active {
             transform: translateY(1px);
         }
         
         #copyOrderBtn.copied {
             background: linear-gradient(to right, #2ecc71, #27ae60);
         }
         /* 添加按钮宽度锁定和图标保护 */
#copyOrderBtn {
  min-width: 180px; /* 根据内容设置最小宽度 */
  transition: all 0.3s ease, background 0.3s ease !important;
}
/* 确保图标可见 */
#copyOrderBtn svg {
  flex-shrink: 0; /* 防止图标被压缩 */
  margin-right: 8px; /* 图标文字间距 */
}

/* 修复动画冲突 */
.copied-animation {
  animation: pulse 0.8s;
  overflow: visible !important; /* 防止动画裁剪 */
}
         /* 响应式设计 */
         @media (max-width: 768px) {
             .container {
                 padding: 20px 15px;
                 border-radius: 12px;
             }
             
             h1 {
                 font-size: 1.5rem;
             }
             
             .subtitle {
                 font-size: 0.9rem;
             }
             
             textarea {
                 padding: 12px;
                 font-size: 0.95rem;
             }
             
             .order-info-container {
                 padding: 20px 15px 20px 20px;
             }
             
             .order-info-item {
                 font-size: 1rem;
             }
             
             #copyOrderBtn {
                 padding: 12px 30px;
                 font-size: 1rem;
                 width: 100%;
             }
         }
         
         @media (max-width: 480px) {
             body {
                 padding: 15px 10px;
             }
             
             .container {
                 padding: 18px 12px;
             }
             
             h1 {
                 font-size: 1.3rem;
             }
             
             textarea {
                 min-height: 80px;
                 font-size: 0.9rem;
             }
             
             .order-info-item {
                 font-size: 0.95rem;
             }
         }
         
         /* 动画效果 */
         @keyframes pulse {
             0% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.7); }
             70% { box-shadow: 0 0 0 12px rgba(46, 204, 113, 0); }
             100% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0); }
         }
         
         .copied-animation {
             animation: pulse 0.8s;
         }
      .form-section, .result-section {
            padding: 30px;
            flex: 1;
        }
        
        .form-section {
            background: #f8f9fa;
            border-right: 1px solid #eaeaea;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        h2 {
            color: #2c3e50;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
            font-size: 1.8rem;
        }
        
        h3 {
            color: #3498db;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .options-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .option-item {
            flex: 1 1 200px;
        }
        
       label {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            background: white;
            border-radius: 10px;
            border: 2px solid #e0e6ed;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        label:hover {
            border-color: #3498db;
            background-color: #e3f2fd;
            transform: translateY(-2px);
        }
        
        input[type="checkbox"],
        input[type="radio"] {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        button {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        #submitBtn {
            background: linear-gradient(to right, #3498db, #2c3e50);
            color: white;
        }
        
        #resetBtn {
            background: linear-gradient(to right, #e74c3c, #c0392b);
            color: white;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
         .s-button-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 30px;
            margin: 50px 0;
        }
        
        .s-btn {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border: none;
            border-radius: 50px;
            padding: 18px 45px;
            font-size: 1.3rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s ease;
            overflow: hidden;
            outline: none;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            min-width: 220px;
        }
        
        /* 基础保存按钮 */
        .save-btn {
            background: linear-gradient(135deg, #3498db, #2ecc71);
            color: white;
        }
        
        .save-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(46, 204, 113, 0.4);
        }
        
        .save-btn:active {
            transform: translateY(2px);
            box-shadow: 0 4px 12px rgba(46, 204, 113, 0.4);
        }
        
        .save-btn i {
            margin-right: 12px;
            font-size: 1.4rem;
            transition: transform 0.3s ease;
        }
        
        .save-btn:hover i {
            transform: scale(1.2);
        }
        
        /* 保存中状态 */
        .saving {
            background: linear-gradient(135deg, #3498db, #9b59b6);
            cursor: not-allowed;
        }
        
        .saving .text {
            visibility: hidden;
            opacity: 0;
        }
        
        .saving::after {
            content: "";
            position: absolute;
            width: 24px;
            height: 24px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        /* 已保存状态 */
        .saved {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }
        
        .saved .text {
            visibility: hidden;
            opacity: 0;
        }
        
        .saved::after {
            content: "\f00c";
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            position: absolute;
            font-size: 1.8rem;
            color: white;
            animation: scaleCheck 0.6s ease;
        }
        
         @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes scaleCheck {
            0% { transform: scale(0); opacity: 0; }
            70% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        @media (max-width: 768px) {
            .s-button-container {
                flex-direction: column;
                align-items: center;
            }
            
            .s-btn {
                width: 100%;
                max-width: 300px;
            }
        }
     </style>
 </head>
 <body>
     <div class="container">
         <header>
           <a href="https://secretppl608.github.io/find.html"
   target="_blank"
   rel="noopener noreferrer"
   class="query-link"
   aria-label="在新窗口打开查询系统">
   查询系统由此去→
           </a>
             <h1>订单信息创建系统</h1>
             <p class="subtitle">惊殊网游数娱</p>
         </header>
         <!-- 一级选项（多选） -->
<div class="input-group">
<label class="highlight">替身卡装扮不补差价，生日气氛组和跑图/小金人单子带人不减半！<br>返图前三张免费，老板多要的按0.1r/张补差。<br>低价改高价要求需要补差额，高价要求改低价要求不退差额，比如普陪15分钟是3.1，病恋15分钟是7.8，那么需要补7.8-3.1=4.7r差价，原价在订单管理可以查到，新价在邀请下单可以查到，注意这里的减数和被减数都是原价，不是折扣价！</label>
     <label>补差价类目，商品时长、商品数量<br>还需补差价<span class="highlight" id="difpriceOuter">¥0.00</span>！</label>
     <select id="difpriceEnter" multiple class="form-control" style="width:30%;">
         <!-- 固定价格服务 -->
         <option value="fixed_service1">指定装扮</option>
         <option value="fixed_service2">指定人</option>
         <option value="fixed_service3">指定技能</option>
         <option value="fixed_service4">开麦</option>
<option value="fixed_service5">送糖/打赏/其他补差</option>  <!-- 按时收费服务 -->
         <option value="time_service1">hw</option>
         <option value="time_service2">小勾文学</option>
         <option value="time_service3">小圈(BDSM)</option>
         <option value="time_service4">单口特殊技能</option>
         <option value="time_service5">高压虐/病</option>
         <option value="time_service6">疯虐/病</option>
         <option value="time_service7">国际服</option>
         <option value="time_service8">续单</option>
         <option value="night_subsidy">夜间补贴</option>
     </select>
     <select id="difpriceTimeEnter" class="form-control" style="width:30%;">

         <option value="15">15分钟</option>
         <option value="30+5">30+5分钟</option>
         <option value="60+15">60+15分钟</option>
         <option value="120+30">120+30分钟</option>

     </select>

<input type="number" min="1" step="1" max="50" value="1" placeholder="数量" style="width:30%;" id="number" required>
</div>
         <div class="input-group">
             <label for="dhenter">粘贴订单号：</label>
             <textarea id="dhenter" placeholder="在此处粘贴订单号..."></textarea>
         </div>

                        <div class="input-group">
             <label>请选择游戏及客服：</label>
                  <select id="yxenter" class="form-control">
<option value="S">光遇---牵手</option><option value="T">光遇---代肝</option><option value="C">超自然行动组</option>
</select>
<select id="kfenter" class="form-control">
<option value="Z">鸭蛋</option>
<option value="Y">素锦</option><option value="U">失忆</option><option value="A">楚曦</option><option value="B">砚冰</option><option value="C">大马猴</option><option value="D">轻</option><option value="E">宵夜</option><option value="F">江月</option><option value="G">沈烬</option><option value="H">昭昭</option><option value="I">悸槐安</option><option value="J">问</option><option value="K">桐</option>
</select>
                        </div>
<div class="input-group">
             <label for="enter">粘贴规格信息：</label>
             <textarea id="skuenter" placeholder="在此处粘贴sku规格信息，该字段不得填写其他内容，只能填充千牛后台生成的sku信息，例如“款式描述:病.虐./抽.象.病.虐.;大小:60赠15min”，缺失时长信息的，默认15min..."></textarea>
         </div>

         <div class="input-group">
             <label for="enter">粘贴物流信息：</label>
             <textarea id="enter" placeholder="在此处粘贴物流信息，操作路径：订单管理（待发货）->每个订单右下角查看物流->复制全部物流信息->粘粘至此处..."></textarea>
         </div>
<div class="input-group">
             <label for="yqenter">填写其他信息：</label>
             <textarea id="yqenter" placeholder="在此处填写邀请码/要求信息，及对sku信息的补充，不得将系统sku粘粘至此字段..."></textarea>
         </div>
         
         <div class="order-info-container">
             <div class="order-info-title">订单信息：</div>
             <div class="order-info-item">惊殊：编号：<span id="ysouter" class="highlight">编号</span></div>
<div class="order-info-item">订单号：<span id="dhouter" class="highlight">等待输入</span></div>
             <div class="order-info-item">游戏名：<span id="yxouter" class="highlight">等待输入</span></div>
             <div class="order-info-item">sku规格：<span id="skuouter" class="highlight">等待输入</span></div>
             <div class="order-info-item">创建时间：<span id="outer" class="highlight">未找到下单时间</span></div>
             <div class="order-info-item">店铺：<span class="highlight">惊殊网游数娱</span></div>
             <div class="order-info-item"><span id="yqouter"></span><span id="pmouter"></span></div>
         </div>
         <!--
         <div class="copy-btn-container">
             <button id="copyOrderBtn">
                 <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                     <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                     <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                 </svg>
                 复制订单信息
             </button>
         </div>
-->
 <div class="s-button-container">
            <button class="s-btn save-btn" id="saveButton">
                <i class="fas fa-save"></i>
                <span class="text">复制并保存</span>
            </button>
             </div>   
             </div>   
   <script>
            // 获取所有DOM元素
const p = document.getElementById('outer');
const logisticsInfo = document.getElementById('enter');
const dhenter = document.getElementById('dhenter');
const dhouter = document.getElementById('dhouter');
const ysouter = document.getElementById('ysouter');
const yxenter = document.getElementById('yxenter');
const yxouter = document.getElementById('yxouter');
const kfenter = document.getElementById('kfenter');
const skuenter = document.getElementById('skuenter');
const skuouter = document.getElementById('skuouter');
const yqenter = document.getElementById('yqenter');
const yqouter = document.getElementById('yqouter');
const number = document.getElementById('number');
const copyButton = document.getElementById('copyOrderBtn');
const pmouter = document.getElementById('pmouter');
const difpriceouter = document.getElementById('difpriceOuter');
const difpriceEnter = document.getElementById('difpriceEnter');
const difpriceTimeEnter = document.getElementById('difpriceTimeEnter');

// 服务价格配置
const servicePrices = {
    fixed_service1: 2.00,
    fixed_service2: 2.00,
    fixed_service3: 3.00,
    fixed_service4: 2.00,
    fixed_service5: 0.01,
    night_subsidy: {
        '15': 0.50,
        '30+5': 1.00,
        '60+15': 2.00,
        '120+30': 4.00
    },
    time_service1: {
        '15': 2.00,
        '30+5': 4.00,
        '60+15': 6.00,
        '120+30': 8.00
    },
    time_service2: {
        '15': 2.00,
        '30+5': 4.00,
        '60+15': 6.00,
        '120+30': 8.00
    },
    time_service3: {
        '15': 2.00,
        '30+5': 4.00,
        '60+15': 6.00,
        '120+30': 8.00
    },
    time_service4: {
        '15': 2.00,
        '30+5': 4.00,
        '60+15': 6.00,
        '120+30': 8.00
    },
    time_service5: {
        '15': 2.00,
        '30+5': 4.00,
        '60+15': 6.00,
        '120+30': 8.00
    },
    time_service6: {
        '15': 2.00,
        '30+5': 4.00,
        '60+15': 6.00,
        '120+30': 8.00
    },
    time_service7: {
        '15': 1.00,
        '30+5': 3.00,
        '60+15': 5.00,
        '120+30': 7.00
    },
    time_service8: {
        '15': 3.00,
        '30+5': 3.00,
        '60+15': 4.50,
        '120+30': 7.50
    }
};

// 单号更新函数
function updateOrderNumber() {
    dhouter.textContent = dhenter.value || "等待输入";
}

function updateOrderCode() {
    // 定义字符集（0-9, A-Z）
    const charset = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    
    if (!dhenter.value) {
        ysouter.textContent = "等待输入";
        return;
    }
    
    try {
        const bigIntOrder = BigInt(dhenter.value);
        const remainder = Number(bigIntOrder % 46656n);
        
        // 计算36进制表示的三个位
        const high = Math.floor(remainder / 1296);
        const mid = Math.floor((remainder % 1296) / 36);
        const low = remainder % 36;
        
        // 组合成三位代码
        const orderCode = charset[high] + charset[mid] + charset[low];
        ysouter.textContent = (kfenter.value || "") + (yxenter.value || "") + orderCode;
    } catch (e) {
        ysouter.textContent = "单号格式错误";
        console.error("订单号处理错误:", e);
    }
}

// 物流时间解析函数
function updateLogisticsTime() {
    const text = logisticsInfo.value;
    const pattern = /已下单[\s\S]*?(\d{4}-\d{2}-\d{2}\s\d{2}:\d{2}:\d{2})[\s\S]*?商品已经下单/m;
    const match = text.match(pattern);
    const realTime = getCurrentDateTime();
    p.textContent = match ? match[1] : realTime;
    p.className = match ? "highlight" : "";
}

function updateGame() {
    yxouter.textContent = yxenter.options[yxenter.selectedIndex].text;
}

function updateSku() {
    skuouter.textContent = (skuenter.value || "") + (yxenter.value=='S'?difpriceTimeEnter.value+"min":"") + (number.value ? "×" + number.value : "");
}

// 更新疫情备注函数 - 修复版
function updateYq() {
    const pmText = updatePriceAndFee(); // 获取价格更新后的文本
    yqouter.textContent = yqenter.value
        ? (pmText ? `${yqenter.value}，` : yqenter.value)
        : "";
}

// 自动选择夜间补贴
function autoSelectNightSubsidy() {
    const now = new Date();
    const hours = now.getHours();
    const nightOption = document.querySelector('#difpriceEnter option[value="night_subsidy"]');
    
    if (hours >= 1 && hours < 6) {
        if (!nightOption.selected) nightOption.selected = true;
    } else {
        if (nightOption.selected) nightOption.selected = false;
    }
}

// 差价系统计算
function difPriceSystem() {
    autoSelectNightSubsidy();
    
    const selectedServices = Array.from(difpriceEnter.selectedOptions).map(opt => opt.value);
    const selectedTime = difpriceTimeEnter.value;
    
    let allPriceSum = 0.00;
    
    selectedServices.forEach(serviceId => {
        const priceInfo = servicePrices[serviceId];
        
        if (typeof priceInfo === 'number') {
            allPriceSum += priceInfo;
        } else if (typeof priceInfo === 'object' && priceInfo[selectedTime] !== undefined) {
            allPriceSum += priceInfo[selectedTime];
        }
    });
    
    return allPriceSum.toFixed(2);
}

// 统一的价格和跑单费更新函数
function updatePriceAndFee() {
    const total = parseFloat(difPriceSystem()) * parseFloat(number.value || 1);
    const pm = parseFloat((total * 0.5).toFixed(2));
    
    difpriceouter.textContent = "¥" + total.toFixed(2);
    
    const selectedOptions = Array.from(difpriceEnter.selectedOptions);
    const selectedValues = selectedOptions.map(option => option.textContent);
    const result = selectedValues.join(', ');
    
    const pmText = pm > 0 ? `${result}+${pm}` : result;
    pmouter.textContent = pmText;
    
    return pmText;
}
     // 复制订单信息功能
function copyOrderInfo() {
  // ...前面的代码不变...
  const infoLines = [
        `惊殊：编号：${ysouter.textContent}`,
        `订单号：${dhouter.textContent}`,
        `游戏名：${yxouter.textContent}`,
        `sku规格：${skuouter.textContent}`,
        `创建时间：${p.textContent}`,
        `店铺：惊殊网游数娱`,
`${yqouter.textContent}${pmouter.textContent}`
    ];
    
    const infoText = infoLines.join('\n');
    
    // 创建临时textarea进行复制
    const tempTextArea = document.createElement('textarea');
    tempTextArea.value = infoText;
    document.body.appendChild(tempTextArea);
    tempTextArea.select();
  try {
    const successful = document.execCommand('copy');
    if (successful) {
      // 克隆原始SVG并修改（保留原始尺寸）
      /* const originalSvg = copyButton.querySelector('svg').cloneNode(true);
      originalSvg.innerHTML = `<polyline points="20 6 9 17 4 12"></polyline>`;
      
      // 只替换文本内容，保留SVG结构
      copyButton.innerHTML = '';
      copyButton.appendChild(originalSvg);
      copyButton.appendChild(document.createTextNode('已复制'));
copyButton.classList.add('copied', 'copied-animation');
     
      // 2秒后恢复
      setTimeout(() => {
        copyButton.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
          </svg>
          复制订单信息
        `;
        copyButton.classList.remove('copied', 'copied-animation');
      }, 2000);
*/
    }
  } catch (err) {
console.error('复制失败:', err);
        alert('复制失败，请手动复制文本。');
  }
 document.body.removeChild(tempTextArea);
}
     function getCurrentDateTime() {
  const now = new Date();

  // 获取日期和时间组件
  const year = now.getFullYear();
  const month = String(now.getMonth() + 1).padStart(2, '0'); // 月份从0开始，需+1
  const day = String(now.getDate()).padStart(2, '0');
  const hours = String(now.getHours()).padStart(2, '0');
  const minutes = String(now.getMinutes()).padStart(2, '0');
  const seconds = String(now.getSeconds()).padStart(2, '0');

  // 组合成目标格式
  return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
     }
     
// 初始化所有功能
function initSystem() {
    // 绑定事件监听
    dhenter.addEventListener('input', function(event){
updateOrderNumber();
updateOrderCode();
getCurrentDateTime();
});
    logisticsInfo.addEventListener('input', updateLogisticsTime);
    yxenter.addEventListener('change', updateGame);
    yxenter.addEventListener('change',function(event){
      updateOrderCode();
       updateSku();
});
    kfenter.addEventListener('input', updateOrderCode);
    skuenter.addEventListener('input', updateSku);
    yqenter.addEventListener('input', updateYq);
    
    number.addEventListener('input', function(event) {
        updateSku();
        updatePriceAndFee();
    });
    
   /* copyButton.addEventListener('click', copyOrderInfo); */
    
    // 差价系统事件监听
    difpriceEnter.addEventListener('change', function(event) {
        updatePriceAndFee();
        updateYq();
    });
    
    difpriceTimeEnter.addEventListener('change', function(event) {
        updatePriceAndFee();
        updateYq();
        updateSku();
    });
    
    // 初始化显示
    updateOrderNumber();
    updateLogisticsTime();
    updateOrderCode();
    updateGame();
    updateSku();
    updatePriceAndFee(); // 初始化价格系统
    updateYq();
  getCurrentDateTime();
}

// 确保DOM加载完成后初始化
document.addEventListener('DOMContentLoaded', initSystem);

const saveButton = document.getElementById('saveButton');
        
        saveButton.addEventListener('click', function() {
            // 切换到保存中状态
            this.classList.remove('saved');
            this.classList.add('saving');
            
            // 模拟保存过程（2秒）
            setTimeout(() => {
                // 切换到已保存状态
                this.classList.remove('saving');
                this.classList.add('saved');
                
                // 3秒后恢复原始状态
                setTimeout(() => {
                    this.classList.remove('saved');
                }, 3000);
            }, 2000);
});

// 替换为你的Supabase项目URL和公钥
document.addEventListener('DOMContentLoaded', function() {
            // 初始化Supabase
            const supabaseUrl = 'https://qccrhtfficbcjkzvgfvq.supabase.co';
            const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFjY3JodGZmaWNiY2prenZnZnZxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5Njk5MTAsImV4cCI6MjA2OTU0NTkxMH0.UXqa7RsC38lfiDMvdC9DpWq7F1ZduqE3wBcTRFaht1o';
            
            // 使用全局的supabase对象来创建客户端
            window.supabase = supabase.createClient(supabaseUrl, supabaseKey);

if (!window.supabase) {
                console.error('Supabase未初始化');
                return;
            }
});            
async function addOrder(){
    const order = {
        order_code: ysouter.textContent,
        order_sigh: dhouter.textContent,
        order_game: yxouter.textContent,
        order_sku: skuouter.textContent,
        order_createTime:p.textContent,
        order_request:yqouter.textContent,
        order_pmouter:pmouter.textContent
    };
    try {
        const {data, error} = await window.supabase
        .from('js_order_info')
        .insert([order]);
        if (error) throw error;
        
        console.log('添加订单成功:', data);
        alert('保存复制成功！');
    } catch (error) {
        console.error('添加订单失败:', error);
        alert('保存失败: ' + error.message);
    }
}

saveButton.addEventListener('click', addOrder);
saveButton.addEventListener('click', copyOrderInfo);
    </script>
</body>
</html>
